'20210410 パラメータは全てグローバルからシート取得に変更

Enum eFixField
    Fix_eTAG 'Alias
    Fix_eNAME 'Type
    Fix_eDESC
    Fix_eIODV
    Fix_eIOAD 'Plc
    Fix_eIOSC 'Lin 4BCD
    Fix_eIOHT 'Long HardWearOption
    Fix_eETAG 'Unit
    Fix_eELO
    Fix_eEHI
    Fix_eIENAB
    Fix_eHIHI
    Fix_eLOLO
    Fix_eADI
End Enum

Enum eFapField
    Fap_eAlias
    Fap_etype
    Fap_eDesc
    Fap_ePlc
    Fap_eIosc
    Fap_eUnit
    Fap_eEhi
    Fap_eElo
    Fap_ehihi
    Fap_elolo
End Enum

'Prefix対策===============================================
Public Function checkNumSt(inpt As String) As String

Dim result As String

result = IsNumeric(CStr(Left(inpt, 1)))

Select Case result
    Case True
    
    result = "MF" & inpt
    
    Case False
    
    result = inpt

End Select

checkNumSt = result

End Function

Function CnvAliasMFtoFap(inptStr As String) As String
    
    Dim sResult As String
    Dim sStr As String: sStr = inptStr
    
    If Not fGetFixAlias(sStr & "_TRQ") = "" Then
        sStr = sStr & "_TRQ"
        Debug.Print sStr
    End If
    
    
    If IsNumeric(Left(sStr, 1)) Then '数字始まりのタグはPrefixを使用する
        sResult = "MF" & sStr
    Else
        sResult = sStr
    End If
    
    CnvAliasMFtoFap = sResult

End Function

Function fFixAdr2FapAdr(inptFix As String, inptFol As String) As String
'PLC01:D:0001 => PLC01.F01.D000001
'PLC01:D:0001:1 => PLC01.F01.D000001@1
'PLC01:D:0001 => PLC01.F01.D000001
'PLC01:Y:A0 => PLC01.F01.Y0000A0
'0:0 => 0:0

Dim sFix As String: sFix = inptFix
Dim sFol As String: sFol = inptFol
Dim aStr() As String
Dim sRslt As String

If sFix = fGetFixAlias(sFix) Then
    sFix = fGetFixPlc(sFix)
End If

aStr = Split(sFix, ":")

If UBound(aStr) >= 3 Then ' @0 or @n

    sRslt = aStr(0) & ".F01." & aStr(1) & fDigit6(aStr(2)) '@0

        If aStr(3) > 0 Then ' @n
            sRslt = sRslt & "@" & aStr(3)
        End If
        
ElseIf UBound(aStr) <= 1 Then 'sim,

    sRslt = sFix

Else ' PLC01.F01.D000001

    sRslt = aStr(0) & "." & sFol & "." & aStr(1) & fDigit6(aStr(2))
   
End If

fFixAdr2FapAdr = sRslt

End Function


'GET FIX DATA
Function CnvFixAlias(inptType As eFixField, inptAlias As String) As String 'e.g cnvFixAlias(Fix_ePlc,"W0001_PV")

Dim sMatchRow As String
Dim sAlias As String: sAlias = inptAlias
Dim sCol As String
Dim sRslt As String

'eFapField
Select Case inptType
    Case Fix_eTAG
        sCol = fKey2Val("PrmSht", "TAG_Column") 'W0001_PV
    
    Case Fix_eNAME
        sCol = fKey2Val("PrmSht", "NAME_Column") 'AI
    
    Case Fix_eDESC
        sCol = fKey2Val("PrmSht", "DESC_Column") '高圧ｽﾁｰﾑ流量
        
    Case Fix_eIODV
        sCol = fKey2Val("PrmSht", "IODV_Column") 'MIQ
        
    Case Fix_eIOAD
        sCol = fKey2Val("PrmSht", "IOAD_Column") 'LC01:D:2000
        
    Case Fix_eIOSC
        sCol = fKey2Val("PrmSht", "IOSC_Column") 'LIN 4BCD

    Case Fix_eIOHT
        sCol = fKey2Val("PrmSht", "IOHT_Column") 'Long HardWearOption
        
    Case Fix_eETAG
        sCol = fKey2Val("PrmSht", "ETAG_Column") 'kg/h
        
    Case Fix_eEHI
        sCol = fKey2Val("PrmSht", "EHI_Column") '32,767
    
    Case Fix_eELO
        sCol = fKey2Val("PrmSht", "ELO_Column") '-32,768

    Case Fix_eHIHI
        sCol = fKey2Val("PrmSht", "HIHI_Column") 'Hihi
    
    Case Fix_eLOLO
        sCol = fKey2Val("PrmSht", "LOLO_Column") 'Lolo

    Case Fix_eIENAB
        sCol = fKey2Val("PrmSht", "IENAB_Column") 'Alarm Enabled
        
    Case Fix_eADI
        sCol = fKey2Val("PrmSht", "ADI_Column") 'Alarm Area A AE
        
End Select

On Error Resume Next

Dim rColAlias As Range
Set rColAlias = Workbooks(fGetDsWbn()).Worksheets(fGetDsWs()).Columns(Columns(fKey2Val("PrmSht", "TAG_Column")).Column)

sMatchRow = Application.WorksheetFunction.Match(sAlias, rColAlias, 0)

If sMatchRow <> "" Then
        sRslt = Workbooks(fGetDsWbn()).Worksheets(fGetDsWs()).Cells(CLng(sMatchRow), sCol).Value
    Else
        sRslt = ""
End If

CnvFixAlias = sRslt


End Function


'Alias===============================================================
Function fGetFixAlias(ByVal inptAlias As String) As String

fGetFixAlias = CnvFixAlias(Fix_eTAG, inptAlias)

End Function


Function fGetFixType(ByVal inptAlias As String) As String

fGetFixType = CnvFixAlias(Fix_eNAME, inptAlias)

End Function


Function fGetFixEhi(ByVal inptAlias As String) As String

fGetFixEhi = CnvFixAlias(Fix_eEHI, inptAlias)

End Function


Function fGetFixElo(ByVal inptAlias As String) As String

fGetFixElo = CnvFixAlias(Fix_eELO, inptAlias)

End Function


Function fGetFixHiHi(ByVal inptAlias As String) As String ' HIHI ep HI

fGetFixHiHi = CnvFixAlias(Fix_eHIHI, inptAlias)

End Function

Function fGetFixLoLo(ByVal inptAlias As String) As String ' LOLO eq LO

fGetFixLoLo = CnvFixAlias(Fix_eLOLO, inptAlias)

End Function

Function fGetFixIENAB(ByVal inptAlias As String) As String ' ALARM AREA

fGetFixIENAB = CnvFixAlias(Fix_eIENAB, inptAlias)

End Function


Function fGetFixADI(ByVal inptAlias As String) As String ' A AE

fGetFixADI = CnvFixAlias(Fix_eADI, inptAlias)

End Function

Function fGetFixUnit(ByVal inptAlias As String) As String

fGetFixUnit = CnvFixAlias(Fix_eETAG, inptAlias)

End Function


Function fGetFixDesc(ByVal inptAlias As String) As String

fGetFixDesc = CnvFixAlias(Fix_eDESC, inptAlias)

End Function


Function fGetFixIODV(ByVal inptAlias As String) As String

fGetFixIODV = CnvFixAlias(Fix_eIODV, inptAlias)

End Function

Function fGetFixIOSC(ByVal inptAlias As String) As String

fGetFixIOSC = CnvFixAlias(Fix_eIOSC, inptAlias)

End Function

Function fGetFixIOHT(ByVal inptAlias As String) As String

fGetFixIOHT = CnvFixAlias(Fix_eIOHT, inptAlias)

End Function

Function fGetFixPlc(ByVal inptAlias As String) As String

fGetFixPlc = CnvFixAlias(Fix_eIOAD, inptAlias)

End Function

