Sub DdeIn()

Dim chan As Variant
Dim result As Variant
Dim sAdrs As String
Dim sTopic As String
Dim sTag As String
Dim sAlias As String
Dim l As Long
Dim v As Variant

    For Each v In Selection
        If Not v.Value = "" Then
            sAlias = v.Value
            sAdrs = GetFapPlc6notDBFol1(sAlias)
            sTopic = fSplitedWithSplt(sAdrs, ".", 1) & "." & fSplitedWithSplt(sAdrs, ".", 2)
            sTag = fSplitedWithSplt(sAdrs, ".", 3)
            
            chan = DDEInitiate("FASERVER", sTopic)
            result = DDERequest(chan, sTag)
            
            If Not TypeName(result) = "Error" Then
                v.Offset(0, 1).Value = result(1)
            End If
        End If
    Next v

    DDETerminate (chan)
    
End Sub

Sub DdeOut()

    Dim chan As Variant
    Dim result As Variant
    Dim sAdrs As String
    Dim sTopic As String
    Dim sTag As String
    Dim sAlias As String
    Dim v As Variant
    Dim lCol As Long: lCol = CLng(Range("C1").Column)

    For Each v In Selection
        If Not v.Value = "" Then
            If lCol = 0 Then lCol = v.Column
            sAlias = Cells(v.Row, lCol).Value
            sAdrs = GetFapPlc6notDBFol1(sAlias)
            sTopic = fSplitedWithSplt(sAdrs, ".", 1) & "." & fSplitedWithSplt(sAdrs, ".", 2)
            sTag = fSplitedWithSplt(sAdrs, ".", 3)

            chan = DDEInitiate("FASERVER", sTopic)
            DDEPoke chan, sTag, Cells(v.Row, v.Column)
        
        End If
    Next v

    DDETerminate (chan)

End Sub
